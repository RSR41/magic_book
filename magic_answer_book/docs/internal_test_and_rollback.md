# 내부 테스트 트랙 점검표 및 롤백 절차

## 대상
- iOS: TestFlight
- Android: Play Console Internal Testing

## 내부 테스트 시나리오 (최소 5개)

| 시나리오 | 절차 | 기대 결과 | 상태 |
|---|---|---|---|
| 첫 실행 ~ 첫 답변 | 앱 설치 → 첫 실행 → 홈 진입 → 질문 입력/흔들기 → 결과 확인 | 온보딩/권한 흐름 문제 없이 첫 결과 도달 | ☐ |
| 다시 뽑기 누적 광고 정책 | 동일 세션에서 다시 뽑기 반복(정책 임계치까지) | 임계치에서 광고 노출, 이후 정책 주기 유지 | ☐ |
| 광고 제거 구매 | 설정 > 광고 제거 구매 진행(성공 케이스) | 결제 성공 후 광고 미노출 상태 즉시 반영 | ☐ |
| 앱 재설치 후 복원 | 광고 제거 구매 완료 상태에서 앱 삭제/재설치 → 복원 실행 | 영수증/구매내역 기반으로 광고 제거 상태 복원 | ☐ |
| 오프라인 동작 | 네트워크 OFF 상태에서 앱 실행 및 답변 생성 | 핵심 기능(답변 생성/조회) 정상 동작, 네트워크 의존 기능만 제한 안내 | ☐ |

## 실수 방지 체크
- [ ] `pubspec.yaml`의 버전/빌드번호 증가 확인 (업로드 거절 방지)
- [ ] iOS/Android 양쪽 릴리즈 노트 동등성 확인 (기능 차이 없이 일관 반영)
- [ ] 복원(restore) 경로를 리뷰어용 시나리오에 포함했는지 확인

---

## 장애 발생 시 롤백 절차 (팀 운영 문서)

### 1) 트리거 조건
- 결제 불가/복원 불가, 광고 과노출, 앱 크래시 증가, 핵심 플로우(첫 답변) 실패율 급증.

### 2) 즉시 조치 (10~30분)
1. 릴리즈 오너가 배포 채널 확산 중단
   - iOS: App Store Connect에서 신규 버전 배포 중지(가능 시), TestFlight 외부 테스터 배포 정지.
   - Android: Play Console에서 프로덕션 단계적 배포 비율 0% 또는 업데이트 중단.
2. 장애 공지
   - 내부 채널에 증상/영향도/우회방법 공지.

### 3) 이전 안정 버전으로 복귀
1. **Android**
   - 직전 안정 AAB를 재사용해 새 롤백 빌드 업로드(항상 더 높은 versionCode 필요).
   - 릴리즈 노트에 "rollback hotfix" 명시 후 단계적 재배포.
2. **iOS**
   - App Store는 바이너리 직접 다운그레이드 불가하므로, 직전 안정 코드 기준으로 새 빌드 번호로 재배포.
   - 긴급 수정 버전 심사 요청(필요 시 expedited review 사유 첨부).

### 4) 검증 게이트
- 내부 5개 시나리오 재실행 100% 통과.
- 결제/복원 로그 샘플 확인.
- 크래시·에러 지표 안정화 확인 후 배포 재개.

### 5) 사후 회고
- 원인 분석(RCA), 탐지 지표 보완, 릴리즈 체크리스트 업데이트.
